<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Dungeon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'DotGothic16', sans-serif;
        }

        .pixel-font {
            font-family: 'DotGothic16', sans-serif;
        }

        .dungeon-view {
            transition: all 0.5s;
            perspective: 800px;
        }

        .wall {
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, #2d3748 25%, #1a202c 25%, #1a202c 50%, #2d3748 50%, #2d3748 75%, #1a202c 75%, #1a202c 100%);
            background-size: 40px 40px;
            border: 8px solid #4a5568;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.8);
        }

        .clay-btn {
            border-radius: 1rem;
            box-shadow: 4px 4px 8px #d1d9e6, -4px -4px 8px #ffffff;
            transition: all 0.2s;
        }

        .clay-btn:active {
            transform: scale(0.95);
            box-shadow: inset 2px 2px 4px #d1d9e6, inset -2px -2px 4px #ffffff;
        }

        .correct-flash {
            animation: flash-green 0.5s;
        }

        .wrong-flash {
            animation: flash-red 0.5s;
        }

        @keyframes flash-green {
            0% {
                background-color: transparent;
            }

            50% {
                background-color: #48bb78;
            }

            100% {
                background-color: transparent;
            }
        }

        @keyframes flash-red {
            0% {
                background-color: transparent;
            }

            50% {
                background-color: #f56565;
            }

            100% {
                background-color: transparent;
            }
        }
    </style>
</head>

<body class="bg-gray-900 h-screen overflow-hidden flex flex-col items-center justify-center text-white select-none">

    <div class="w-full max-w-md px-4 flex flex-col items-center gap-6">

        <!-- Score Board -->
        <div class="flex justify-between w-full">
            <div class="bg-gray-800 rounded-lg px-4 py-2 border border-gray-600">
                <span>üë£ Ê≠•Êï∏: </span><span id="score" class="text-yellow-400">0</span>
            </div>
            <div class="bg-gray-800 rounded-lg px-4 py-2 border border-gray-600">
                <span>‚ù§Ô∏è ÁîüÂëΩ: </span><span id="hp" class="text-red-400">3</span>
            </div>
        </div>

        <!-- Dungeon Visualization -->
        <div id="view-container"
            class="relative w-[300px] h-[300px] flex items-center justify-center bg-black rounded-lg overflow-hidden border-4 border-gray-700">
            <div id="scene" class="dungeon-view">
                <div class="wall"></div>
            </div>

            <!-- Character overlay (simple representation) -->
            <div class="absolute bottom-4 text-6xl animate-bounce">
                üßô‚Äç‚ôÇÔ∏è
            </div>

            <!-- Direction Hint (Hidden initially) -->
            <div id="hint-overlay"
                class="absolute inset-0 flex items-center justify-center bg-black/80 hidden opacity-0 transition-opacity duration-300">
                <span id="hint-text" class="text-4xl font-bold text-yellow-400">LEFT</span>
            </div>
        </div>

        <!-- Status Message -->
        <div class="h-12 flex items-center justify-center">
            <p id="status-text" class="text-gray-400 text-center text-sm">ËÅÜËÅΩÊåá‰ª§‰∏¶ÈÅ∏ÊìáÊñπÂêë...</p>
        </div>

        <!-- Controls -->
        <div class="grid grid-cols-3 gap-4 w-full">
            <button onclick="checkAnswer('LEFT')"
                class="clay-btn bg-indigo-600 hover:bg-indigo-500 p-6 flex flex-col items-center gap-2">
                <span class="text-3xl">‚¨ÖÔ∏è</span>
                <span class="text-xs">Left</span>
            </button>
            <button onclick="checkAnswer('FORWARD')"
                class="clay-btn bg-indigo-600 hover:bg-indigo-500 p-6 flex flex-col items-center gap-2">
                <span class="text-3xl">‚¨ÜÔ∏è</span>
                <span class="text-xs">Forward</span>
            </button>
            <button onclick="checkAnswer('RIGHT')"
                class="clay-btn bg-indigo-600 hover:bg-indigo-500 p-6 flex flex-col items-center gap-2">
                <span class="text-3xl">‚û°Ô∏è</span>
                <span class="text-xs">Right</span>
            </button>
        </div>

        <button onclick="playCurrentInstruction()"
            class="bg-yellow-600 hover:bg-yellow-500 text-white px-6 py-2 rounded-full text-sm flex items-center gap-2 mt-4">
            üîä ÂÜçËÅΩ‰∏ÄÊ¨°
        </button>

    </div>

    <!-- Modals -->
    <div id="game-over-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center rounded-lg">
        <div class="bg-white text-gray-900 p-8 rounded-2xl text-center max-w-sm">
            <h2 class="text-2xl font-bold mb-4">Ëø∑Ë∑Ø‰∫ÜÔºÅ</h2>
            <p class="mb-6">‰Ω†Ëµ∞‰∫Ü <span id="final-score" class="text-indigo-600 font-bold">0</span> Ê≠•</p>
            <button onclick="restartGame()"
                class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 w-full mb-2">ÂÜçË©¶‰∏ÄÊ¨°</button>
        </div>
    </div>

    <script>
        const COMMANDS = [
            { id: 'LEFT', text: 'Turn Left', audioText: "Turn Left" },
            { id: 'RIGHT', text: 'Turn Right', audioText: "Turn Right" },
            { id: 'FORWARD', text: 'Go Forward', audioText: "Go Forward" },
            { id: 'LEFT', text: 'Go Left', audioText: "Go Left" },
            { id: 'RIGHT', text: 'Go Right', audioText: "Go Right" },
            { id: 'FORWARD', text: 'Move Ahead', audioText: "Move Ahead" },
            { id: 'STOP', text: 'Stop', audioText: "Stop!", isTrap: true }
        ];

        let currentCommand = null;
        let score = 0;
        let hp = 3;
        let isProcessing = false;

        function init() {
            score = 0;
            hp = 3;
            updateUI();
            nextTurn();
        }

        function nextTurn() {
            if (hp <= 0) return;

            isProcessing = false;
            document.getElementById('status-text').textContent = "ËÅÜËÅΩ‰∏≠...";
            document.getElementById('hint-overlay').classList.add('hidden');

            // Randomly select command
            // Simple logic: 30% left, 30% right, 30% forward, 10% trap (not implemented yet for simplicity)
            const roll = Math.random();
            if (roll < 0.33) currentCommand = COMMANDS.find(c => c.id === 'LEFT');
            else if (roll < 0.66) currentCommand = COMMANDS.find(c => c.id === 'RIGHT');
            else currentCommand = COMMANDS.find(c => c.id === 'FORWARD');

            // Play audio after short delay
            setTimeout(() => {
                playCurrentInstruction();
            }, 500);
        }

        function playCurrentInstruction() {
            if (!currentCommand) return;
            const u = new SpeechSynthesisUtterance(currentCommand.audioText);
            u.lang = 'en-US';
            u.rate = 0.9;
            window.speechSynthesis.speak(u);
        }

        function checkAnswer(direction) {
            if (isProcessing) return;
            isProcessing = true;

            const isCorrect = currentCommand.id === direction;

            if (isCorrect) {
                // Animation
                animateMove(direction);
                score++;
                playSound('step');
                updateUI();
                setTimeout(() => nextTurn(), 800);
            } else {
                // Wrong
                document.getElementById('view-container').classList.add('wrong-flash');
                setTimeout(() => document.getElementById('view-container').classList.remove('wrong-flash'), 500);

                playSound('hurt');
                hp--;
                updateUI();

                // Show hint
                const hintEl = document.getElementById('hint-overlay');
                const hintText = document.getElementById('hint-text');
                hintEl.classList.remove('hidden');
                hintEl.classList.remove('opacity-0');
                hintText.textContent = currentCommand.text;

                if (hp <= 0) {
                    setTimeout(gameOver, 1000);
                } else {
                    setTimeout(() => {
                        hintEl.classList.add('hidden');
                        nextTurn();
                    }, 1500);
                }
            }
        }

        function animateMove(dir) {
            const scene = document.getElementById('scene');
            if (dir === 'FORWARD') {
                scene.style.transform = 'scale(1.2)';
            } else if (dir === 'LEFT') {
                scene.style.transform = 'rotateY(-20deg) translateX(20px)';
            } else if (dir === 'RIGHT') {
                scene.style.transform = 'rotateY(20deg) translateX(-20px)';
            }

            setTimeout(() => {
                scene.style.transform = 'none';
            }, 300);
        }

        function playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const g = ctx.createGain();
            osc.connect(g);
            g.connect(ctx.destination);

            if (type === 'step') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(100, ctx.currentTime);
                g.gain.setValueAtTime(0.1, ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc.start();
                osc.stop(ctx.currentTime + 0.1);
            } else if (type === 'hurt') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(50, ctx.currentTime + 0.3);
                g.gain.setValueAtTime(0.2, ctx.currentTime);
                g.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            }
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('hp').textContent = hp;
        }

        function gameOver() {
            document.getElementById('final-score').textContent = score;
            document.getElementById('game-over-modal').classList.remove('hidden');
        }

        function restartGame() {
            document.getElementById('game-over-modal').classList.add('hidden');
            init();
        }

        init();
    </script>
</body>

</html>